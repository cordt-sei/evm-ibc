"use strict";(self.webpackChunkibc_transfer_ui=self.webpackChunkibc_transfer_ui||[]).push([[2150],{68248:(e,n,t)=>{t.d(n,{r:()=>w});var i=t(29109),o=t(60445),l=t(46759),a=t(47979),s=(t(96540),t(83650),t(69648)),r=(t(88393),t(80066),t(74848),t(41253)),d=(t(95821),t(3418),t(48702),t(91845)),c=(t(10941),t(16219),t(12174),t(54769),t(60337)),u=(t(4402),t(11011),t(40337),t(81285),t(45468),t(12707)),v=(t(99157),t(7116),t(20433),t(83073),t(21029)),m=(t(63055),t(28765),t(40961),t(20545),t(50574),t(451),t(30593),t(7085)),f=t(15047),g=(t(87237),t(80607),t(78816)),h=(t(6864),t(29147),t(72366),t(55537),t(65381),t(75705),t(27373),t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(18983),t(21858),t(80622),t(31825),t(89809));const w=({authMethod:e})=>{const{handleLogOut:n,setShowAuthFlow:t,setCallback:w,setMultiWalletWidgetState:y,walletConnectorOptions:p}=(0,h.J)(),{setDeniedOauthUsername:C,setDeniedOauthProvider:b}=(0,v.iU)(),{view:k,setView:S,goToInitialView:W}=(0,r.At)(),{setLoading:A}=(0,m.nk)(),{setErrorMessage:M,setError:I}=(0,c.pu)(),{setExistentAccountData:O}=(0,a.g)(),j=(0,g.M)(),{shouldAutoCreateEmbeddedWallet:E,shouldPromptForKeyExport:V}=(0,f.L)(),T=(e,{options:n={},onError:t})=>{var i;if(e instanceof o.pY||e instanceof o.$S)throw e;if(e instanceof o.xi||e instanceof o.Sh||e instanceof o.TI||e instanceof o.mC||e instanceof o.rp)throw e;return e instanceof o.av?(b(null==e?void 0:e.socialProvider),C(null!==(i=null==e?void 0:e.socialUsername)&&void 0!==i?i:""),void S("no-access")):e instanceof o.aT?(O(e.errorPayload),void S("account-exists")):void(e instanceof o.Pf?S("sandbox-maximum-threshold-reached"):e instanceof o.Vh?S("merge-user-accounts-with-same-email",{returnToView:"isEmailRecoveryFlow"in n&&n.isEmailRecoveryFlow?"passkey-recovery-add-email":void 0}):t?null==t||t(e):e.code?M(e.code):I(e.message))},P=()=>(0,i.s)(void 0,void 0,void 0,(function*(){s.v.debug("cancelAuth",{authMethod:e}),yield n(),W()}));return{cancelAuth:P,completeAuth:n=>(0,i.s)(void 0,[n],void 0,(function*({completeSignInFlow:n,updateJwtFunction:o,onValidUpdatedJwt:a,options:r={}}){s.v.debug("completeAuth",{authMethod:e});try{const{updateUserProfileResponse:e,isSmsVerificationRequired:s,isEmailVerificationRequired:r,missingFields:c}=yield o();null==a||a();const v=(0,u.n)({expiresAt:e.expiresAt,jwt:e.jwt,minifiedJwt:e.minifiedJwt,user:e.user});if(c.length>0)return void(yield(d={isEmailVerificationRequired:r,isSmsVerificationRequired:s,missingFields:c},(0,i.s)(void 0,[d],void 0,(function*({missingFields:e,isEmailVerificationRequired:n,isSmsVerificationRequired:t}){n&&e.find((e=>"email"===e.name))?S("verify-email"):t&&e.find((e=>"phoneNumber"===e.name))?S("verify-sms"):S(k.type)}))));if(yield j(v),w("authSuccess"),n&&(yield n(e)))return;E()||v.mfaBackupCodeAcknowledgement===l._7V.Pending||t(!1)}catch(e){s.v.debug(e),T(e,{options:r})}finally{A(!1)}var d})),handleAuthError:T,initAuth:n=>(0,i.s)(void 0,[n],void 0,(function*({isSignIn:n=!0,verifyFunction:i,onVerifySuccess:l,onSettled:a,onError:r,showSuccessMessage:c=!1,skipDefaultErrorHandling:v=!1}){var m;s.v.debug("initAuth",{authMethod:e,isSignIn:n});try{const e=yield i();if(!e)throw yield P(),new o.ii("No user returned from verify function");let s;if(s=e.user?(0,u.n)(e):e,null==l||l(s),p.forEach((e=>{e.walletConnector.setVerifiedCredentials(s.verifiedCredentials)})),(0,d._)(s))return;if(n&&(null===(m=s.missingFields)||void 0===m?void 0:m.length))return;y("idle"),yield j(s);const r=E(s),v=V();c&&(yield(0,o.yy)(1500)),n&&w("authSuccess"),r||v||t(!1),null==a||a()}catch(e){if(s.v.debug(e),v)return void(null==r||r(e));T(e,{onError:r})}finally{A(!1),null==a||a()}}))}}},84176:(e,n,t)=>{t.d(n,{r:()=>m});var i=t(29109),o=t(96540),l=t(6864),a=t(46759),s=t(60445),r=t(29147),d=t(69648),c=(t(88393),t(80066),t(74848),t(41253),t(95821),t(49122)),u=(t(3418),t(48702),t(10941),t(16219)),v=t(72366);const m=({onSubmit:e,onError:n,userProfile:t,shouldEnforcePolicies:m=!0,fields:f})=>{var g;const{mockedSDK:h}=(0,r.lc)(),[w,y]=(0,o.useState)(!1),{fieldsConfig:p}=(0,v.t)(),C=m&&(null===(g=f.find((e=>"policiesConsent"===e.name)))||void 0===g?void 0:g.enabled),b=e=>`${e.charAt(0).toUpperCase()+e.slice(1)} is required`,k=(0,o.useMemo)((()=>(0,l.Ik)().shape(Object.fromEntries(f.map((({name:e,required:n,type:t,validationType:i,validationRules:o})=>{let l=t===a.cc8.Custom?(0,c.g)(v.V,i):(0,c.g)(p,e).validation;return t!==a.cc8.Custom||!o||i!==a.Muc.Select&&i!==a.Muc.Text||(o.validOptions?l=l.oneOf(o.validOptions.map((e=>e.label)),"Select a valid option"):o.regex&&(l=l.matches(new RegExp(o.regex),"Invalid field format"))),[e,n?l.required(b(e)):l]}))))),[f]),S=(0,o.useMemo)((()=>Object.fromEntries(f.map((({name:e,type:n,validationRules:i,validationType:o})=>{var l,s,r,d;const v=null!=t?t:{};if(n===a.cc8.Custom){let n="";return o===a.Muc.Select&&(null==i?void 0:i.validOptions)&&(n=null!==(l=i.validOptions[0].label)&&void 0!==l?l:""),[e,(()=>{var t;const i=v.metadata?(0,c.g)(v.metadata,e):void 0;return Array.isArray(i)?i:null!==(t=null==i?void 0:i.toString())&&void 0!==t?t:n})()]}const m=null!==(s={country:u.Ns[0].code,policiesConsent:!1,tShirtSize:u.Rc[0],team:u.gD[0]}[e])&&void 0!==s?s:"";return[e,null!==(d=null===(r=(0,c.g)(v,e))||void 0===r?void 0:r.toString())&&void 0!==d?d:m]})))||{}),[f,t]),W=(0,o.useCallback)(((o,l)=>(0,i.s)(void 0,void 0,void 0,(function*(){const i={},r={};if(!h)try{if(!(null==t?void 0:t.environmentId))throw new s.ii("Invalid environment ID");y(!0);let n=o;Object.entries(n).forEach((([e,t])=>{const o=f.find((n=>n.name===e&&n.type===a.cc8.Custom));o&&(i[e]=t,delete n[e],o.unique&&(r[e]=t))})),Object.keys(i).length>0&&(n.metadata=i),C&&(n=Object.assign(Object.assign({},n),{policiesConsent:!0}),delete n.policiesConsentArray),yield null==e?void 0:e(n)}catch(e){d.v.error(e),null==n||n(e),e instanceof s.xi?l.setErrors({email:"Email already exists"}):e instanceof s.Sh?l.setFormikState((e=>Object.assign(Object.assign({},e),{errors:Object.fromEntries(Object.entries(r).map((([e])=>[e,Object.entries(r).length>1?"One or more fields are already tied to another user":`${e} is already tied to another user`]))),touched:Object.fromEntries(Object.entries(r).map((([e])=>[e,!0]))),values:Object.assign(Object.assign({},S),r)}))):e instanceof s.mC?l.setErrors({email:"Too many email verification attempts."}):e instanceof s.TI?l.setErrors({username:"Username already exists"}):e instanceof s.rp?l.setErrors({phoneNumber:e.message}):l.setErrors({api:"Something went wrong. Please try again."})}finally{y(!1)}}))),[h,null==t?void 0:t.environmentId,C,e,f,n,S]);return{enforcePolicies:C,fetch:w,formikInitialValues:S,formikValidationSchema:k,onFormSubmit:W}}},451:(e,n,t)=>{t.d(n,{_:()=>o});var i=t(6864);const o=(0,i.Ik)().shape({alias:(0,i.Yj)(),btcWallet:(0,i.Yj)(),ckbWallet:(0,i.Yj)(),country:(0,i.Yj)(),discordNotification:(0,i.zM)(),dogeWallet:(0,i.Yj)(),email:(0,i.Yj)(),emailNotification:(0,i.zM)(),firstName:(0,i.Yj)(),jobTitle:(0,i.Yj)(),kasWallet:(0,i.Yj)(),kdaWallet:(0,i.Yj)(),lastName:(0,i.Yj)(),ltcWallet:(0,i.Yj)(),metadata:(0,i.Ik)(),newsletterNotification:(0,i.zM)(),phoneNumber:(0,i.Yj)(),tShirtSize:(0,i.Yj)(),team:(0,i.Yj)(),username:(0,i.Yj)()})},14170:(e,n,t)=>{t.d(n,{U:()=>y});var i=t(29109),o=t(96540),l=(t(83650),t(46759),t(69648),t(88393),t(80066),t(74848),t(41253)),a=(t(95821),t(60445)),s=(t(3418),t(48702),t(10941),t(16219),t(12174)),r=(t(54769),t(60337),t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(18003)),d=(t(20433),t(83073),t(21029),t(47979),t(63055),t(28765)),c=t(63137),u=(t(40961),t(20545),t(50574),t(11016)),v=(t(30593),t(7085),t(87237),t(80607),t(6864),t(29147),t(72366),t(55537)),m=t(451),f=t(65381),g=(t(75705),t(27373),t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(18983),t(21858),t(80622),t(31825),t(89809)),h=t(83943);const w=e=>{const{user:n,projectSettings:t,setShowAuthFlow:r}=(0,g.J)(),{setView:d}=(0,l.At)(),c=(0,o.useContext)(f.i);if(!c)throw new a.ii("useUserUpdateRequest can only be used inside the context of DynamicContextProvider");const{open:u}=c,v=(0,o.useCallback)(((o,l)=>new Promise(((a,c)=>{const v=((e,n,t)=>{if(!e.length)return"At least one field must be provided for editing";if(!n)return"No signed-in user";const i=(0,h.cb)({customFields:null==t?void 0:t.customFields,projectSettingsKyc:null==t?void 0:t.kyc,user:n});for(const n of e)if(!i.find((({name:e})=>e===n)))return`Please ensure field "${n}" is enabled under "Configurations > Onboarding > Information capture" in your app's dashboard before using it with updateUserWithModal`;return""})(o,n,t);v?c(v):u({fields:o,submitText:null==l?void 0:l.submitText,subtitle:null==l?void 0:l.subtitle,title:null==l?void 0:l.title},e).then((e=>{return n=e,t=r,o=d,l=a,u=c,(0,i.s)(void 0,[n,t,o,l,u],void 0,(function*({fields:e,updateUserResult:{isEmailVerificationRequired:n,isSmsVerificationRequired:t}},i,o,l,a){if(n||t){if(i(!0,{ignoreIfIsEmbeddedWidget:!1,performMultiWalletChecks:!1}),n)return o("verify-email"),void s.zm.once("emailVerificationResult",((n,t)=>{e.email=t,n?l(e):a("Failed to verify email, no fields were updated")}));o("verify-sms"),s.zm.once("smsVerificationResult",((n,{phone:t})=>{e.phoneNumber=t,n?l(e):a("Failed to verify phone number, no fields were updated")}))}else l(e)}));var n,t,o,l,u})).catch((e=>{if(/email already exists/gi.test(e))throw e;c(e)}))}))),[n,t,u,e,r,d]);return v},y=({validationSchemaStripUnknown:e})=>{const n=(e=>{const{environmentId:n,userWithMissingInfo:t}=(0,g.J)(),{setRetryData:l}=(0,d.vm)(),{selectedPhoneCountry:a}=(0,v.OT)(),s=(0,u.u)();return(0,o.useCallback)(((o,d)=>(0,i.s)(void 0,void 0,void 0,(function*(){var i,u;let{metadata:v}=o;v=v?Object.assign(Object.assign({},null==t?void 0:t.metadata),v):null==t?void 0:t.metadata;const f=yield m._.validate(o,{stripUnknown:e});f.phoneNumber&&f.phoneNumber.length>0&&a.current&&l({dialCode:a.current.dialCode,iso2:a.current.iso2,phone:f.phoneNumber});const g=yield(0,r.zz)(null!==(i=null==d?void 0:d.userEnvironmentId)&&void 0!==i?i:n,Object.assign(Object.assign({},f),{metadata:v})),h=null!==(u=g.user.missingFields)&&void 0!==u?u:[],w=(0,c.C)(g.nextView);return w?s({destination:w,missingFields:h,updateUserProfileResponse:g}):{isEmailVerificationRequired:!1,isSmsVerificationRequired:!1,missingFields:h,updateUserProfileResponse:g}}))),[null==t?void 0:t.metadata,e,a,l,n,s])})(e);return{updateUser:n,updateUserWithModal:w(n)}}},60054:(e,n,t)=>{t.d(n,{u:()=>h});var i=t(29109),o=t(96540),l=t(69648),a=t(15988),s=t(10941),r=t(3194),d=t(20433),c=t(60445),u=t(18003),v=t(99157),m=(t(48702),t(69793)),f=(t(81285),t(19325));const g=e=>(0,i.s)(void 0,[e],void 0,(function*({environmentId:e,logout:n}){const t=(0,m.M)(),i=(0,f.c)(),o=(0,v.wz)();if(i||!o)return!0;if(o&&!i&&t){try{yield(0,u.vD)({environmentId:e})}catch(e){if(e instanceof c.q)return yield n("user auth cookie invalid",{authToken:i,user:o}),!1}return!0}return yield n("user data out of sync",{authToken:i,user:o}),!1})),h=({environmentId:e,handleLogOut:n})=>{const t=(0,o.useCallback)(((e,t)=>(0,i.s)(void 0,void 0,void 0,(function*(){return l.v.debug(`Logging out due to invalid session - Reason: ${e}`,Object.assign({},t)),n()}))),[n]),c=(0,o.useCallback)((()=>(0,i.s)(void 0,void 0,void 0,(function*(){const n={environmentId:e,logout:t};var o;yield Promise.all([(o=n,(0,i.s)(void 0,[o],void 0,(function*({environmentId:e,logout:n}){const t=(0,d.nN)();return!t||e===t||(yield n("store and environment are out of sync",{currentEnvId:e,storedEnvId:t}),(0,d.Zq)(e),!1)}))),g(n)]),(0,s.uN)({sessionValidation:!0})}))),[e,t]);(0,a.S)((()=>{c()})),(0,r.h)("triggerSessionValidation",c)}},58296:(e,n,t)=>{t.d(n,{e:()=>S});var i=t(29109),o=t(60445),l=t(80066),a=(t(96540),t(12174)),s=(t(83650),t(46759),t(69648)),r=(t(88393),t(74848),t(41253)),d=(t(95821),t(53968)),c=(t(3418),t(48702),t(10941),t(16219),t(89809)),u=(t(54769),t(60337)),v=t(83219),m=(t(4402),t(11011),t(79622)),f=(t(81285),t(45468),t(99157),t(7116),t(52331)),g=t(81149),h=t(21029),w=t(47979),y=t(63055),p=t(71585),C=t(90745),b=(t(28765),t(40337),t(40961),t(20545),t(30447)),k=(t(50574),t(451),t(30593),t(68248));t(83073),t(6864),t(29147),t(72366),t(55537),t(65381),t(75705),t(20433),t(27373),t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(87237),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(7085),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(80607),t(18983),t(21858),t(80622),t(31825);const S=({displaySiweStatement:e,environmentId:n,projectSettings:t,setIsSingleWalletAccount:S})=>{const{setExistentAccountData:W}=(0,w.g)(),{setDeniedAddress:A,setDeniedOauthProvider:M}=(0,h.iU)(),{setView:I,goToInitialView:O}=(0,r.At)(),{setErrorMessage:j,setError:E}=(0,u.pu)(),{multiWalletWidgetState:V,debugError:T,multiWallet:P,appName:R,primaryWalletId:_,setShowAuthFlow:x,siweStatement:F,connectedWallets:N,authMode:U,user:L,setAuthMode:q,removeConnectedWalletsInfo:Y,events:D,primaryWallet:z,enableConnectOnlyFallback:$,selectedWalletConnector:K}=(0,c.J)(),{addedWalletsIds:J}=(0,y.i0)(),{initAuth:B}=(0,k.r)({authMethod:"wallet"}),{generateSessionKey:H,shouldRegisterSessionKeysOnSignin:Q}=(0,b.t)({environmentId:n,projectSettings:t}),X=!L,G=$&&(X||!P),Z=({walletConnector:e,endSession:n=!0})=>{Y(),n&&(null==e||e.endSession())},ee=(e,n,i,r)=>{var d;if("ignore"===e.message)return;if(K&&K.key===n.key&&a.zm.emit("authFailure",{address:i,connectorName:n.name,option:n.name,type:"wallet"},{error:e}),e instanceof o.pm)return Z({endSession:!1,walletConnector:n}),(e=>{var n;x(!0),I("wallet-used"),S(!1),"reassign_wallet_error"===e.code&&((null===(n=null==t?void 0:t.sdk)||void 0===n?void 0:n.preventOrphanedAccounts)&&I("wallet-cannot-be-transferred"),S(!0))})(e);if(e instanceof o.gB)return I("merge-user-accounts",Object.assign({},e)),void x(!0);if(e instanceof o.Pm)return Z({walletConnector:n}),A(i),void I("chainalysis-blocked-wallet");if(e instanceof o.gV)return Z({walletConnector:n}),A(i),void I("gate-blocked-wallet");if(e instanceof o.Pf)return void I("sandbox-maximum-threshold-reached");if(e instanceof o.av)return Z({walletConnector:n}),A(i),(0,l.eL)(n)&&M(null==r?void 0:r.provider),void I("no-access");if(e instanceof o.aT)return Z({walletConnector:n}),W(e.errorPayload),void I("account-exists");if(N.length&&"connect-only"===U)throw new o.ii(e.message);const c=null===(d=null==e?void 0:e.message)||void 0===d?void 0:d.includes("User rejected the request");if(G&&!c)return s.v.warn("Verification failed, changing to connect-only"),q("connect-only"),void I("wallet-list");Z({walletConnector:n}),O(),s.v.error(e),T?E(`${e.message}\n ${e.stack}`):j(e.code)};return t=>(0,i.s)(void 0,[t],void 0,(function*({walletConnector:t,getAddressOpts:l,publicWalletAddress:r,captchaToken:c,oauth:u,signedMessageOverride:h,messageToSignOverride:w}){const y=(0,C.z)(t);a.zm.emit("authInit",{address:r,connectorName:t.name,option:t.name,type:"wallet"});try{const{verifyFunction:a,verifyArgs:C}=yield((t,o,l,a,s,r,d,c)=>(0,i.s)(void 0,void 0,void 0,(function*(){const i=yield(0,m.d)({displaySiweStatement:e,environmentId:n,getAddressOpts:l,messageToSignOverride:c,publicWalletAddress:a,signedMessageOverride:d,siweStatement:(0,p.i)({appName:R,siweStatement:F}),walletConnector:t,walletProvider:o});if(Q()){const e=yield H();i.sessionPublicKey=e.publicKey}let u;return u=L&&P?(0,f.KM)(n,i):(0,f.XR)(n,Object.assign(Object.assign({},i),{captchaToken:s,oauth:r})),{verifyArgs:i,verifyFunction:()=>u}})))(t,y,l,r,c,u,h,w);yield B({isSignIn:X,onError:e=>{ee(e,t,r,u)},onVerifySuccess:e=>{var n;if(!e)throw new o.ii(v.nM);try{null===(n=null==D?void 0:D.onSignedMessage)||void 0===n||n.call(D,{messageToSign:C.messageToSign,signedMessage:C.signedMessage})}catch(e){s.v.warn("Error calling onSignedMessage callback")}o.n$.setItem(d.$1,t.key),q("connect-and-sign"),(({walletConnector:e,verifiedCredentials:n,lastVerifiedCredentialId:t})=>{const i=n.find((e=>e.id===t&&"blockchain"===e.format));if(i){const t=n.find((e=>e.id===_));(X||!z||"awaiting_signature"===V&&i.walletName===(null==t?void 0:t.walletName)||"flow"===(null==t?void 0:t.chain)&&"FLOW"===e.connectedChain)&&(0,g.q)(i.id)}})({lastVerifiedCredentialId:e.lastVerifiedCredentialId,verifiedCredentials:e.verifiedCredentials,walletConnector:t});const i=e.lastVerifiedCredentialId;i&&J.current.push(i)},options:{address:r,connectorName:t.name},skipDefaultErrorHandling:!0,verifyFunction:a})}catch(e){ee(e,t,r,u)}}))}},63192:(e,n,t)=>{t.d(n,{q:()=>o}),t(96540),t(83650),t(46759),t(69648),t(88393),t(80066),t(74848),t(41253),t(95821),t(60445),t(3418),t(48702),t(10941),t(16219),t(12174),t(29109),t(54769),t(60337),t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(20433),t(83073),t(21029),t(47979),t(63055),t(28765),t(40961),t(20545),t(50574),t(451),t(30593),t(7085),t(87237),t(80607),t(6864),t(29147),t(72366),t(55537),t(65381),t(75705),t(27373),t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(18983),t(21858),t(80622),t(31825);var i=t(89809);const o=e=>{var n,t,o;const{projectSettings:l,overrides:a}=(0,i.J)(),s=null===(t=null===(n=null==l?void 0:l.sdk)||void 0===n?void 0:n.views)||void 0===t?void 0:t.find((n=>n.type===e));return(null===(o=null==a?void 0:a.views)||void 0===o?void 0:o.find((n=>n.type===e)))||s}},20176:(e,n,t)=>{t.d(n,{g:()=>s});var i=t(29109),o=t(96540),l=t(80426),a=(t(12174),t(69206));const s=(e,{onChange:n}={onChange:()=>{}})=>{const[t,s]=(0,o.useState)(),{isLoading:r}=(0,l.v)((()=>null==e?void 0:e.getNetwork()),{deps:[e],onResolve:e=>{s(e)}});return(0,a.k)(e||void 0,"chainChange",(({chain:t})=>{const i="STARK"===(null==e?void 0:e.connectedChain)?t:parseInt(t);s(i),null==n||n(i)})),(0,a.k)(e||void 0,"disconnect",(()=>(0,i.s)(void 0,void 0,void 0,(function*(){if("argentx"!==(null==e?void 0:e.key))return;const t=yield e.getNetwork();s(t),null==n||n(t)})))),{isLoading:r,network:t}}},61485:(e,n,t)=>{t.d(n,{M:()=>a});var i=t(29109),o=t(80066),l=t(46759);const a=(e,n,t,a)=>(0,i.s)(void 0,void 0,void 0,(function*(){if(!(0,o.eL)(n))return;const i=null==e?void 0:e.verifiedCredentials.find((e=>e.format===l.z3W.Oauth&&e.address&&(0,o.Lb)(e.address,t,a)));i&&i.oauthProvider&&(yield n.connect(i.oauthProvider))}))},35567:(e,n,t)=>{t.d(n,{n:()=>h});var i=t(29109),o=t(96540),l=t(60445),a=t(80066),s=t(63055),r=t(46759),d=t(69648),c=(t(88393),t(74848),t(41253),t(95821),t(3418),t(48702),t(10941),t(16219),t(12174)),u=(t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(81149)),v=t(41701),m=t(41305),f=t(42475);const g=e=>"phantomledger"===e.walletName?(e=>Object.assign(Object.assign({},e),{walletName:"phantom",walletProperties:{hardwareWallet:r.PXK.Ledger}}))(e):e,h=({authMode:e,connectedWallets:n,walletConnectorOptions:t,setMultiWalletWidgetState:h,primaryWalletId:w,user:y,canHaveMultipleWalletsConnected:p,separateSmartWalletAndSigner:C=!1})=>{const[b,k]=(0,o.useState)(!1),S=(0,o.useRef)(w),W=(0,o.useMemo)((()=>y?(({user:e,walletConnectorOptions:n,primaryWalletId:t,separateSmartWalletAndSigner:i})=>n&&e?e.verifiedCredentials.map(g).map((o=>{var l,s;const d=(0,v.T)(o,n);return d?(o.id===t&&(0,m.I)(d.walletConnector)&&d.walletConnector.connect(),(null===(l=o.walletProperties)||void 0===l?void 0:l.hardwareWallet)===r.PXK.Ledger&&(0,a.fg)(d.walletConnector)&&(d.walletConnector.isHardwareWalletEnabled=!0),!i&&(0,f.Ej)(o,e.verifiedCredentials)?null:o.address&&o.chain?(o.walletProvider===r.EDz.SmartContractWallet&&(0,f.$1)({account:o,primaryWalletId:t,verifiedCredentials:e.verifiedCredentials,walletConnectorOptions:n}),d.walletConnector.createWallet({additionalAddresses:o.walletAdditionalAddresses,address:o.address,chain:d.walletConnector.connectedChain,connector:d.walletConnector,id:o.id,isAuthenticated:!0,key:null!==(s=o.walletName)&&void 0!==s?s:d.walletConnector.key})):null):null})).filter((e=>null!==e)):[])({primaryWalletId:w,separateSmartWalletAndSigner:C,user:y,walletConnectorOptions:t}):[]),[y,w,t,C]);d.v.logVerboseTroubleshootingMessage("linkedWallets",W);const A=(0,o.useMemo)((()=>"connect-and-sign"===e&&y||"connect-only"===e&&W.find((e=>(0,a.WX)(e.connector)))?W:null!=n?n:[]),[e,n,W,y]);d.v.logVerboseTroubleshootingMessage("wallets",A),(0,o.useEffect)((()=>A.forEach((e=>{e.connector.initEventListener()}))),[A]);const{setUserWallets:M}=(0,s.i0)();(0,o.useEffect)((()=>{d.v.logVerboseTroubleshootingMessage("[useWalletConnectors] will call setUserWallets",A),M((e=>((e,n)=>{const t=[...e],i=new Set,o=new Set;for(const e of n){i.add(e.address),o.add(e.chain);const n=t.findIndex((n=>n.address===e.address&&n.chain===e.chain));-1!==n?t[n]=e:t.push(e)}return t.filter((e=>i.has(e.address)&&o.has(e.chain)))})(e,A)))}),[M,A]);const I=(0,o.useMemo)((()=>{var e;return null!==(e=A.find((e=>e.id===w)))&&void 0!==e?e:null}),[w,A]);(0,o.useEffect)((()=>{I&&I.id!==S.current&&(S.current=I.id,c.zm.emit("primaryWalletChanged",I))}),[I]);const O=(0,o.useMemo)((()=>p?A.filter((e=>e.id!==w)):[]),[w,A,p]),j=(0,o.useCallback)((e=>(0,i.s)(void 0,void 0,void 0,(function*(){const n=A.find((({id:n})=>n===e));if(!n)throw new l.ii(`Wallet with id: ${e} not found`);return n}))),[A]),E=(0,o.useCallback)((e=>(0,i.s)(void 0,void 0,void 0,(function*(){const n=yield j(e);if(!w)return yield n.connector.connect(),void(0,u.q)(e);if(w!==e){if((0,a.VC)(n.connector)){const e=n.connector,t=localStorage.getItem("magic-link-email");t&&e.setEmail(t)}(0,u.q)(e),h("idle")}}))),[j,w,h]);return{primaryWallet:I,secondaryWallets:O,setPrimaryWallet:E,setShowQrcodeModal:k,showQrcodeModal:b,wallets:A}}},42475:(e,n,t)=>{t.d(n,{$1:()=>d,Ej:()=>r,K3:()=>s});var i=t(29109),o=t(80066),l=t(48702),a=t(41701);const s=(e,n)=>n.find((n=>n.signerRefId===e.id)),r=(e,n)=>Boolean(s(e,n)),d=e=>(0,i.s)(void 0,[e],void 0,(function*({account:e,verifiedCredentials:n,walletConnectorOptions:t,primaryWalletId:i}){var s,r,d,c,u;const v=((e,n)=>n.find((n=>n.id===e.signerRefId)))(e,n);if(!v)throw new Error("could not find associated eoa account for smart wallet");const m=(0,a.T)(v,t);if(!m)throw new Error("could not find owner wallet from wallet options");if(m&&(0,o.NN)(m.walletConnector)){const n=null===(r=null===(s=m.walletConnector)||void 0===s?void 0:s.verifiedCredentials)||void 0===r?void 0:r.reduce(((n,t)=>t.smartWalletRefAddress&&e.address&&e.chain&&(0,o.Lb)(t.smartWalletRefAddress,e.address,l.Ik[e.chain])?[t,...n]:[...n,t]),[]);n&&m.walletConnector.setVerifiedCredentials(n)}const f=(0,a.T)(e,t);if(!f)throw new Error("could not find smart wallet from wallet options");const g=f.walletConnector;if(!(0,o.Pg)(g))throw new Error("could not initialize smart wallet");if(!v.address||!e.address)throw new Error("could not find owner or smart wallet address");const h=i===v.id||i===e.id;yield g.registerEoa({ecdsaProviderType:null===(d=e.walletProperties)||void 0===d?void 0:d.ecdsaProviderType,entryPointVersion:null===(c=e.walletProperties)||void 0===c?void 0:c.entryPointVersion,eoaAddress:v.address,eoaConnector:m.walletConnector,kernelVersion:null===(u=e.walletProperties)||void 0===u?void 0:u.kernelVersion,shouldSetEoaConnector:h,smartWalletAddress:e.address})}))},68568:(e,n,t)=>{t.d(n,{Q:()=>u});var i=t(29109),o=t(96540),l=t(80066),a=(t(46759),t(69648)),s=(t(88393),t(74848),t(41253),t(95821),t(60445),t(3418),t(48702),t(10941),t(16219),t(3194)),r=t(69206),d=t(12174),c=(t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(81149));const u=({disconnectWallet:e,handleLogOut:n,multiWallet:t,multiWalletWidgetState:u,primaryWallet:v,secondaryWallets:m,selectedWalletConnector:f,selectedWalletWithAction:g,setSelectedWalletConnectorKey:h,setSelectedWalletWithAction:w,setMultiWalletWidgetState:y,user:p,authMode:C,refreshConnectedWallet:b,detectNewWalletsForLinking:k})=>{const S=(0,o.useCallback)(((e,n)=>{a.v.debug("handleAccountChangeWhenAwaitingAccountSwitch",{isPrimaryWallet:e,newAddress:n});const t=m.find((e=>(0,l.Lb)(e.address,n,e.chain)));if(a.v.logVerboseTroubleshootingMessage("[handleAccountChangeWhenAwaitingAccountSwitch]",{linkedSecondaryWallet:t}),!t)return y("awaiting_signature",void 0,"linking_new_wallet"),void(e&&v&&h(v.connector.key));t.connector.isAvailable?(w(null),(0,c.q)(t.id),y("idle")):d.zm.emit("triggerConnectAndSign")}),[y,v,m,h,w]),W=(0,o.useCallback)((({accounts:e})=>{if(a.v.debug("calculatePrimaryWalletMultiWalletStateFromAccounts",{accounts:e,authMode:C,multiWallet:t,multiWalletWidgetState:u,primaryWallet:v}),!v)return;const[n]=e;if((0,l.Lb)(n,v.address,v.chain))return void y("idle");if("connect-only"===C)return void b(v.id,v.connector);if(!t)return;if("awaiting_account_switch"===u)return void S(!0,n);"idle"!==u&&(a.v.error(`Unexpected multiWalletWidgetState (${u}) and onAccountChange combination. Resetting state to idle.`),y("idle"));const i=m.find((e=>(0,l.Lb)(e.address,n,e.chain)));i?(0,c.q)(i.id):p&&k&&(y("detected_new_wallet"),h(v.connector.key))}),[C,k,S,t,u,v,b,m,y,h,p]);(0,s.h)("triggerComputePrimaryWalletMultiWalletStateFromAccounts",W),(0,r.k)(null==v?void 0:v.connector,"accountChange",(({accounts:e})=>{a.v.debug("primary wallet account change",{accounts:e}),W({accounts:e})}));const A=(0,o.useMemo)((()=>{const e=null==v?void 0:v.connector,n=m.map((({connector:e})=>e)),t=new Set([...n,e,f].filter((e=>Boolean(e))));return e&&t.delete(e),Array.from(t)}),[m,f,null==v?void 0:v.connector]);(0,r.k)(A,"accountChange",((e,n)=>(0,i.s)(void 0,void 0,void 0,(function*(){if(a.v.debug("secondary wallet account change"),"connect-only"===C&&m.length){const e=m.filter((({connector:e})=>e.key===n.key));for(const n of e)b(n.id,n.connector)}else"awaiting_account_switch"===u&&S(!1,(null==g?void 0:g.wallet.address)||"")})))),(0,r.k)(null==v?void 0:v.connector,"disconnect",(()=>{a.v.debug("primary wallet disconnect"),"connect-only"===C&&n()})),(0,r.k)(A,"disconnect",(n=>{if(a.v.debug("secondary wallet disconnect"),"connect-only"===C){const t=m.filter((({connector:e})=>e.key===n.key));for(const n of t)e(n.id)}})),(0,r.k)(A,"chainChange",(({chain:e},n)=>{d.zm.emit("nonPrimaryWalletNetworkChanged",e,n)}))}},9778:(e,n,t)=>{t.d(n,{f:()=>w});var i=t(29109),o=t(60445),l=t(80066),a=(t(96540),t(83650),t(46759),t(69648)),s=(t(88393),t(74848),t(41253)),r=(t(95821),t(53968)),d=(t(3418),t(48702),t(10941),t(16219),t(12174)),c=t(71571),u=t(60337),v=(t(21029),t(47979),t(63055),t(45468),t(4402),t(11011),t(40337),t(21537)),m=(t(81285),t(20433),t(83073),t(99157),t(7116),t(54769),t(28019)),f=(t(28765),t(40961),t(20545),t(50574),t(451),t(30593),t(7085),t(87237),t(80607),t(6864),t(29147)),g=(t(72366),t(55537),t(65381),t(75705),t(27373),t(20045)),h=(t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(18983),t(21858),t(80622),t(31825),t(89809));const w=()=>{const{setMultiWalletWidgetState:e,setShowAuthFlow:n,setSelectedWalletConnectorKey:t,walletConnectorOptions:w,setQrcodeUri:y,setDesktopUri:p,user:C,linkedWallets:b,setLegacyIsVerifying:k,authMode:S}=(0,h.J)(),{mockedSDK:W}=(0,f.lc)(),{setError:A,setErrorMessage:M}=(0,u.pu)(),{setView:I,goToInitialView:O}=(0,s.At)(),{onlyConnectUser:j}=(0,m.F)(),E=(0,c.s)(),V=n=>(0,i.s)(void 0,void 0,void 0,(function*(){a.v.debug("handleCustodialWalletClick",n);const i=(0,v.$)(n);a.v.logVerboseTroubleshootingMessage("[handleCustodialWalletClick]",{twoStepAuthentication:i}),i?(t(n.key),yield j({walletConnector:n})):(t(n.key),e("awaiting_signature",void 0,"linking_new_wallet")),I("pending-signature")})),T=e=>(0,i.s)(void 0,void 0,void 0,(function*(){var n;if(a.v.debug("handleMobileWalletClick",e),t(e.key),"phantom"===e.key){const e=o.n$.getItem(r.jF);o.n$.setItem(r.jF,{loseOriginalAccountOnTransfer:null!==(n=null==e?void 0:e.loseOriginalAccountOnTransfer)&&void 0!==n&&n,submittedAtTimestamp:(new Date).toString(),verificationType:"awaiting_verification"})}const i=()=>{j({shouldShowPendingConnectView:!1,walletConnector:e})};I("mobile-wallet-redirect-view",{onRetry:i}),i()})),P=n=>(0,i.s)(void 0,void 0,void 0,(function*(){a.v.debug("handleInstalledExtensionClick",n),t(n.key),"connect-only"===S?(I("pending-connect"),j({walletConnector:n})):e("awaiting_signature",void 0,"linking_new_wallet")})),R=e=>(0,i.s)(void 0,void 0,void 0,(function*(){a.v.debug("handleUninstalledClick",e),t(e.key),e.canConnectViaQrCode?(E({getAddressOpts:{onDesktopUri:e=>(0,i.s)(void 0,void 0,void 0,(function*(){p(e)})),onDisplayUri:e=>(0,i.s)(void 0,void 0,void 0,(function*(){y(e)}))},walletConnector:e}),I("qr-code")):I("no-qr-not-installed"),A(void 0)})),_=o=>(0,i.s)(void 0,void 0,void 0,(function*(){a.v.debug("handleAlreadyConnectedWallet",o),n(!1);const i=yield o.getConnectedAccounts(),l=b.find((e=>{var n;return e.address.toLowerCase()===(null===(n=i[0])||void 0===n?void 0:n.toLowerCase())}));a.v.logVerboseTroubleshootingMessage("[handleAlreadyConnectedWallet]",{activeAccountAlreadyLinked:l,connectedAccounts:i,linkedWallets:b,walletConnectorKey:o.key}),t(o.key),l?"unknown"===l.connector.key?d.zm.emit("triggerConnectAndSign",o):e("awaiting_account_switch","linking_new_wallet"):e("awaiting_signature",void 0,"linking_new_wallet")}));return{handleAlreadyConnectedWallet:_,handleCustodialWalletClick:V,handleInstalledExtensionClick:P,handleMobileWalletClick:T,handleUninstalledClick:R,handleWalletItemClick:e=>(0,i.s)(void 0,void 0,void 0,(function*(){const{walletConnector:n,isInstalledOnBrowser:i}=e,s="FLOW"===n.connectedChain||(0,l.Pt)(n);if(a.v.logVerboseTroubleshootingMessage("[handleWalletItemClick]",{mockedSDK:W,shouldEndWalletConnectorSession:s,wallet:e}),W)return;s&&(yield n.endSession()),k(!1);const r="metamask"===n.key;if("connect-only"!==S&&r)try{t(n.key),I("pending-connect"),yield n.chooseAccountsToConnect()}catch(e){if(e instanceof o.vx)return M("connection_rejected"),void O()}(0,g.o)(b,n,C)&&"FLOW"!==n.connectedChain?_(n):n.canConnectViaCustodialService?V(n):(0,o.Fr)()?"walletconnect"===n.key?I("wallet-connect-mobile-wallets-list"):T(n):i?P(n):R(n)})),openWallet:(e,n)=>{var t;const{openMobileWallet:i=T,openCustodialWallet:l=V,openExtensionWallet:a=P}=n||{},s=null===(t=w.find((n=>n.key===e)))||void 0===t?void 0:t.walletConnector;s&&((0,o.Fr)()?i(s):s.canConnectViaCustodialService?l(s):s.isInstalledOnBrowser()&&a(s))}}}},82238:(e,n,t)=>{t(29109),t(96540),t(80066),t(60445),t(83650),t(46759),t(69648),t(88393),t(74848),t(41253),t(95821),t(3418),t(48702),t(10941),t(16219),t(12174),t(54769),t(60337),t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(20433),t(83073),t(21029),t(47979),t(63055),t(28765),t(40961),t(20545),t(50574),t(451),t(30593),t(7085),t(87237),t(80607),t(6864),t(29147),t(72366),t(55537),t(65381),t(75705),t(27373),t(9778),t(95081),t(100),t(58080),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(23121),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(79620),t(59553),t(31448),t(98592),t(18983),t(21858),t(80622),t(31825),t(89809)},81464:(e,n,t)=>{t.d(n,{S:()=>f});var i=t(29109),o=t(74848),l=t(96540),a=t(95081),s=(t(60445),t(100),t(58080),t(12174),t(83650),t(46759),t(69648),t(88393),t(80066),t(41253),t(95821),t(3418),t(48702),t(10941),t(16219),t(54769),t(60337),t(4402),t(11011),t(40337),t(81285),t(45468),t(99157),t(7116),t(20433),t(83073),t(21029),t(47979),t(63055),t(28765),t(15896)),r=(t(20545),t(50574),t(451),t(30593),t(7085),t(87237),t(80607),t(6864),t(29147),t(72366),t(55537),t(65381),t(75705),t(27373),t(80622),t(23121),t(31825),t(40961),t(53006),t(11012),t(71172),t(14624),t(44432),t(79903),t(53454),t(74566),t(85168),t(71092),t(26968),t(56950),t(43433),t(87583),t(30261),t(96696),t(58169),t(4623),t(22923),t(44917),t(94734),t(26490),t(10647),t(78080),t(95253),t(44719),t(30014)),d=(t(79620),t(59553),t(31448),t(98592),t(18983),t(82951)),c=t(33828),u=t(88014),v=t(95108),m=t(50882);const f=({appLogoUrl:e,appName:n,hideEmbeddedWalletTransactionUIs:t=!1})=>{const f=(0,l.useRef)("enabled"),{t:g}=(0,a.Bd)(),{modal:h,open:w}=(0,s.Y)({elementId:"dynamic-send-transaction"}),{modal:y,open:p}=(0,s.Y)({elementId:"dynamic-sign-message"}),{modal:C,open:b}=(0,s.Y)({elementId:"dynamic-enter-password"}),{modal:k,open:S}=(0,s.Y)({elementId:"dynamic-create-password"}),{modal:W,open:A}=(0,s.Y)({elementId:"dynamic-sync-wallet"}),{modal:M,open:I}=(0,s.Y)({elementId:"dynamic-prompt-to-add-network"}),O=(0,l.useCallback)((()=>"disabled"!==f.current||(f.current="enabled",!1)),[f]),j=(0,l.useCallback)((l=>(0,i.s)(void 0,[l],void 0,(function*({walletConnector:l,message:a,handler:s}){return O()?p(((i,r)=>(0,o.jsx)(c.$,{appLogoUrl:e,appName:n,message:a,handler:s,onSignMessage:i,onReject:r,hideModal:t&&!(null==l?void 0:l.isGlobalTransaction)}))).then((e=>(0,i.s)(void 0,void 0,void 0,(function*(){return"callHandlerOutsideModal"===e?s():e})))):s()}))),[e,n,t,p,O]),E=(0,l.useCallback)(((e,n)=>(0,i.s)(void 0,void 0,void 0,(function*(){return O()?w(((i,l)=>(0,o.jsx)(v.F,{copykey:"dyn_send_transaction.confirmation.title",title:g("dyn_send_transaction.confirmation.title"),transaction:n,onTransactionResponseSuccess:i,onReject:l,walletConnector:e,hideModal:t&&!(null==e?void 0:e.isGlobalTransaction)}))).then((e=>(0,i.s)(void 0,void 0,void 0,(function*(){return"callHandlerOutsideModal"===e?n.submit():e})))):n.submit()}))),[t,w,O,g]),V=(0,l.useCallback)(((e,n)=>(0,i.s)(void 0,void 0,void 0,(function*(){return O()?w(((i,l)=>(0,o.jsx)(v.F,{copykey:"dyn_send_transaction.confirmation.title",title:g("dyn_send_transaction.confirmation.title"),transaction:n,onTransactionResponseSuccess:i,onReject:l,walletConnector:e,hideModal:t&&!(null==e?void 0:e.isGlobalTransaction)}))).then((e=>(0,i.s)(void 0,void 0,void 0,(function*(){return"callHandlerOutsideModal"===e?n.submit():e})))):n.submit()}))),[t,w,O,g]),T=(0,l.useCallback)((e=>(0,i.s)(void 0,[e],void 0,(function*({handler:e,closeView:n=!0}){return b(((t,i)=>(0,o.jsx)(d.$,{handler:e,onResolve:t,onReject:i,closeView:n})))}))),[b]),P=(0,l.useCallback)((e=>(0,i.s)(void 0,[e],void 0,(function*({closeView:e=!0}){return S(((n,t)=>(0,o.jsx)(r.n,{onResolve:n,onReject:t,closeView:e})))}))),[S]),R=(0,l.useCallback)((e=>(0,i.s)(void 0,[e],void 0,(function*({walletConnector:e,activeAddress:n,expectedAddress:t}){yield A(((i,l)=>(0,o.jsx)(u.S,{onResolve:i,onReject:l,connector:e,expectedAddress:t,activeAddress:n})))}))),[A]),_=(0,l.useCallback)((e=>(0,i.s)(void 0,[e],void 0,(function*({handler:e,network:n,walletConnector:t}){yield I((i=>(0,o.jsx)(m.$,{network:n,walletConnector:t,onCancel:i,onNetworkAdded:i,addNetworkMutation:e})))}))),[I]),x=(0,l.useCallback)((()=>{f.current="disabled"}),[]),F=(0,l.useMemo)((()=>({addNetwork:_,createPassword:P,disabledConfirmationOnce:x,enterPassword:T,sendTransaction:E,signMessage:j,signTransaction:V,syncWallet:R})),[j,V,x,E,T,P,R,_]);return(0,l.useMemo)((()=>[y||h||C||k||W||M,F]),[y,h,C,k,W,M,F])}}}]);